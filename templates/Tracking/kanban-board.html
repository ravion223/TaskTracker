{% extends 'base.html' %}
{% block body %}
{% load static %}

<div class="kanban-board">
    <div class="column" id="todo">
        <h3>To Do</h3>
        {% for task in tasks %}
            {% if task.status == 'todo' %}
                <div class="task" id="task{{ task.id }}"> <!-- Unique id for each task -->
                    <h4>{{ task.title }}</h4>
                    <p>{{ task.description }}</p>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    <div class="column" id="in-progress">
        <h3>In Progress</h3>
        {% for task in tasks %}
            {% if task.status == 'in_progress' %}
                <div class="task" id="task{{ task.id }}"> <!-- Unique id for each task -->
                    <h4>{{ task.title }}</h4>
                    <p>{{ task.description }}</p>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    <div class="column" id="done">
        <h3>Done</h3>
        {% for task in tasks %}
            {% if task.status == 'done' %}
                <div class="task" id="task{{ task.id }}"> <!-- Unique id for each task -->
                    <h4>{{ task.title }}</h4>
                    <p>{{ task.description }}</p>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var todo = document.getElementById('todo');
        var inProgress = document.getElementById('in-progress');
        var done = document.getElementById('done');

        var sortableTodo = new Sortable(todo, {
            group: 'kanban',
            animation: 150,
            draggable: '.task', // Ensure tasks are draggable
            onEnd: function(evt) {
                moveTask(evt.item.id, 'todo');
            }
        });

        var sortableInProgress = new Sortable(inProgress, {
            group: 'kanban',
            animation: 150,
            draggable: '.task', // Ensure tasks are draggable
            onEnd: function(evt) {
                moveTask(evt.item.id, 'in_progress');
            }
        });

        var sortableDone = new Sortable(done, {
            group: 'kanban',
            animation: 150,
            draggable: '.task', // Ensure tasks are draggable
            onEnd: function(evt) {
                moveTask(evt.item.id, 'done');
            }
        });

        function moveTask(taskId, newStatus) {
            fetch(`/update_task_status/${taskId}/${newStatus}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Task status updated successfully');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    moveTask(7, 'to-do');
    });

    

</script>

{% endblock body %}



